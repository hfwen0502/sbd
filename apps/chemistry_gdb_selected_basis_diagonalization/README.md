# A sample program for parallelized selected basis diagonalization

Sample code for computing the ground state of a quantum chemistry Hamiltonian based on sampled bitstrings representing determinant.

This code assumes that the determinant is represented by the occupation of all alpha-spin and beta-spin orbitals.
The Hilbert space is defined as the determinants written in the determinant files.
The quantum chemistry Hamiltonian should be provided as a text file in FCIDUMP format.

- The determinant is expected to be provided as many plain text files, with one bitstring per line.
Each bitstring is ordered from right to left, meaning the rightmost bit corresponds to alpha-spin orbital 1, the next to beta-spin orbital 1, and so on.
Note that the spatial orbital labels correspond to the orbital indices defined in the FCIDUMP format described below.

- The FCIDUMP format is a commonly used quantum chemistry format that first lists two-electron integrals
$v_{ijkl} = \int d{\bf r}_1 d{\bf r}_2 \phi_i({\bf r}_1) \phi_k ({\bf r}_2) \vert {\bf r}_1 - {\bf r}_2 \vert^{-1} \phi_l ({\bf r}_2) \phi_j ({\bf r}_1)$
followed by one-electron integrals
$h_{ij} = \int d {\bf r} \phi_i ({\bf r}) \hat{h} \phi_j({\bf r})$.
[P. J. Knowles, N.C. Handy, Computer Physics Communications, {\bf 54}(1), 75-83 (1989)](https://doi.org/10.1016/0010-4655(89)90033-7)
For an example, see the `fcidump_Fe4S4.txt` file in the directory, which corresponds to an iron ion cluster.

- The ground state is computed using the Davidson algorithm. The calculation starts from an initial state in which all the weight is
placed on the product state corresponding to the first bitstring (after sorting) in `det.txt`. In other words, the FCIDUMP file
is asssumed to define the basis in terms of molecular orbitals, and the initial state described above is regarded as the Hartree-Fock solution.

- For more details about the bitstring format used in `AlphaDets.txt` and the FCIDUMP file, please refer to the *User Guide* page generated by Doxygen.
You can generate the documentation by running the command `doxygen ./doc/Doxyfile` from the top level directory of this package.


## Requirement

- c++17
- OpenMP
- MPI
- BLAS and LAPACK

## Build

- Open the `Configuration` file and edit the environment variables according to your system: the compiler command (CCCOM), compiler options (CCFLAGS), and linker options (SYSLIB), and the path to the sbd library (SBD_PATH).

- After editing the configuration, run the make command to generate the executable:
    ```
    make
    ```

## Command-Line Arguments for Executable

For usage examples, please refer to the `run.sh` script included in this directory. It shows how to run the executable with various command-line options.

Below is an explanation of each command-line option.

- `--fcidump <str>`:  
  The name of the FCIDUMP file that defines the Hamiltonian integrals.
- `--detfiles <str>,<str>,...,<str>`:  
  The names of the file containing the set of determinants (bitstrings).
- `--loadname <str>`:  
  The name of the file containing the wavefunction data to load. If not specified, no loading is performed and the Hartreeâ€“Fock (HF) solution is used as the initial state.
- `--savename <str>`:  
  The name of the file in which to save the resulting wavefunction data. If not specified, the wavefunction is not saved.
- `--b_comm_size <int>`:
  Specifies the size of the basis communicator.
- `--t_comm_size <int>`:  
  Specifies the size of the task communicator. This controls how the operations on the column indices of the Hamiltonian are distributed during matrix-vector multiplication.
- `--method <int>`:  
  - 0: The Davidson algorithm is performed, and the Hamiltonian is not stored explicitly and is applied to the wavefunction on-the-fly.
  - 1: The Davidson algorithm is performed, and the Hamiltonian matrix is stored to accelerate matrix-vector multiplication at the cost of higher memory usage.
- `--iteration <int>`:  
  The number of Davidson restarts to perform.
- `--block <int>`:  
  The maximum size of the subspace used in the Davidson method.
- `--tolerance <float>`:  
  Convergence threshold for the Davidson method. It determines the stopping criterion based on the norm of the residual vector.
- `--carryover_ratio <float>`:  
  The ratio of bitstrings with large wavefunction weights to be retained during the selection step.
- `--shuffle <int>`:  
  Whether to shuffle the order of input half-determinants. If set to 0, no shuffling is performed; otherwise, the input is shuffled.
- `--rdm <int>`:  
  Whether to compute the 1-particle and 2-particle reduced density matrices (1pRDM and 2pRDM). If set to 0, they are not computed; otherwise, they are computed.
- `--carryovername <str>`:
  Specifies the filename to store the carryover determinants.
- `--bit_length <int>`:  
  Specifies the bit length handled by each size_t when representing bitstrings using `std::vector<size_t>`. The default value is 20.
